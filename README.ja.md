# mmlabc-to-smf-rust

Music Macro Language (MML) ã‹ã‚‰ Standard MIDI File (SMF) ã¸ã®å¤‰æ›ãƒ„ãƒ¼ãƒ«ï¼ˆRustç‰ˆï¼‰

## æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€[mmlabc-to-smf](https://github.com/cat2151/mmlabc-to-smf) ã®Rustå®Ÿè£…ç‰ˆã§ã™ã€‚
Music Macro Languageå½¢å¼ã®æ–‡å­—åˆ—ã‚’ã€åŒ…æ‹¬çš„ãªãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ã‚’å‚™ãˆãŸ4ãƒ‘ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ä½¿ç”¨ã—ã¦Standard MIDI Fileã«å¤‰æ›ã—ã¾ã™ã€‚

## çŠ¶æ³

### å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ âœ…
- **åŸºæœ¬éŸ³ç¬¦å¤‰æ›**: `cdefgab` â†’ MIDIéŸ³ç¬¦ã¸ã®å¤‰æ›
- **4ãƒ‘ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: å®Œå…¨å®Ÿè£…æ¸ˆã¿
  - ãƒ‘ã‚¹1: MMLæ–‡å­—åˆ—ã®ãƒˆãƒ¼ã‚¯ãƒ³åŒ–ï¼ˆå˜ç´”ãƒ‘ãƒ¼ã‚µãƒ¼ï¼‰
  - ãƒ‘ã‚¹2: ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ASTï¼ˆæŠ½è±¡æ§‹æ–‡æœ¨ï¼‰ã¸ã®å¤‰æ›
  - ãƒ‘ã‚¹3: ASTã‹ã‚‰MIDIã‚¤ãƒ™ãƒ³ãƒˆã®ç”Ÿæˆ
  - ãƒ‘ã‚¹4: MIDIã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰Standard MIDI Fileä½œæˆ
- **ãƒãƒ£ãƒ³ãƒãƒ«æ©Ÿèƒ½**: ã‚»ãƒŸã‚³ãƒ­ãƒ³ï¼ˆ`;`ï¼‰ã«ã‚ˆã‚‹å¤šãƒãƒ£ãƒ³ãƒãƒ«å¯¾å¿œ
- **JSON ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›**: å„ãƒ‘ã‚¹ã®ä¸­é–“çµæžœã‚’JSONã§å‡ºåŠ›
- **CLI**: ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã«ã‚ˆã‚‹åŸºæœ¬æ“ä½œ
- **åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ**: 35å€‹ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒã™ã¹ã¦é€šéŽ

### å‹•ä½œç¢ºèª
```bash
# åŸºæœ¬éŸ³éšŽå¤‰æ›
cargo run -- "cdefgab"

# å¤šãƒãƒ£ãƒ³ãƒãƒ«
cargo run -- "c;e;g"

# ã‚«ã‚¹ã‚¿ãƒ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
cargo run -- "cde" -o my_song.mid
```

## ä»Šå¾Œã®è¦‹é€šã—

### çŸ­æœŸç›®æ¨™ ðŸš§
- **tree-sitterçµ±åˆ**: ã‚ˆã‚Šè¤‡é›‘ãªMMLæ§‹æ–‡ã®è§£æžã«å‘ã‘ã¦
- **ãƒªãƒã‚¸ãƒˆãƒªè¨­å®š**: ãƒ•ã‚©ãƒ¼ãƒžãƒƒã‚¿ãƒ¼ã€ãƒªãƒ³ã‚¿ãƒ¼ç­‰ã®è¨­å®šæ•´å‚™
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ã‚ˆã‚Šè©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### é•·æœŸç›®æ¨™ ðŸŽ¯
- **mmlabcã‚³ãƒžãƒ³ãƒ‰å®Ÿè£…**: å®Œå…¨ãªmmlabcãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆå¯¾å¿œ
  - éŸ³é•·æŒ‡å®šï¼ˆ4åˆ†éŸ³ç¬¦ã€8åˆ†éŸ³ç¬¦ç­‰ï¼‰
  - ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–æŒ‡å®šï¼ˆ`>`, `<`ï¼‰
  - ãƒ†ãƒ³ãƒã€éŸ³é‡ç­‰ã®åˆ¶å¾¡ã‚³ãƒžãƒ³ãƒ‰
  - å’ŒéŸ³æ©Ÿèƒ½ã®æ‹¡å¼µ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–**: å¤§è¦æ¨¡MMLãƒ•ã‚¡ã‚¤ãƒ«ã®é«˜é€Ÿå‡¦ç†

### å‚è€ƒè³‡æ–™
- mmlabcã«ã¤ã„ã¦ã¯ã€[mml2abc](https://github.com/cat2151/mml2abc)ãƒªãƒã‚¸ãƒˆãƒªã‚’å‚ç…§

## ç‰¹å¾´

- **4ãƒ‘ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**:
  - **ãƒ‘ã‚¹1**: MMLæ–‡å­—åˆ—ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã«è§£æžï¼ˆç¾åœ¨ï¼šå˜ç´”ãƒ‘ãƒ¼ã‚µãƒ¼ã€å°†æ¥ï¼štree-sitterï¼‰
  - **ãƒ‘ã‚¹2**: ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŠ½è±¡æ§‹æ–‡æœ¨ï¼ˆASTï¼‰ã«å¤‰æ›
  - **ãƒ‘ã‚¹3**: ASTã‹ã‚‰MIDIã‚¤ãƒ™ãƒ³ãƒˆã‚’ç”Ÿæˆ
  - **ãƒ‘ã‚¹4**: Standard MIDI Fileã‚’ä½œæˆ
- **å¤šãƒãƒ£ãƒ³ãƒãƒ«å¯¾å¿œ**: ã‚»ãƒŸã‚³ãƒ­ãƒ³ï¼ˆ`;`ï¼‰ã«ã‚ˆã‚‹åŒæ™‚ç™ºéŸ³ãƒãƒ£ãƒ³ãƒãƒ«åˆ†é›¢
- **JSON ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›**: å„ãƒ‘ã‚¹ã®ä¸­é–“çµæžœã‚’JSONå½¢å¼ã§ä¿å­˜ãƒ»ç¢ºèªå¯èƒ½
- **åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ**: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆåˆè¨ˆ35å€‹ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
- **å®‰å…¨ãªè¨­è¨ˆ**: Rustã®åž‹ã‚·ã‚¹ãƒ†ãƒ ã¨æ‰€æœ‰æ¨©ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§

## å¿…è¦è¦ä»¶

- Rust 1.70.0ä»¥ä¸Š
- Cargo

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### é–‹ç™ºç‰ˆï¼ˆç¾åœ¨ã®çŠ¶æ…‹ï¼‰

```bash
git clone https://github.com/cat2151/mmlabc-to-smf-rust
cd mmlabc-to-smf-rust
cargo build --release
```

### ç›´æŽ¥å®Ÿè¡Œï¼ˆCargoçµŒç”±ï¼‰

```bash
cargo run -- "cdefgab"
```

## ä½¿ã„æ–¹

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```bash
# åŸºæœ¬éŸ³éšŽã®å¤‰æ›
cargo run -- "cdefgab"

# å¤šãƒãƒ£ãƒ³ãƒãƒ«ï¼ˆåŒæ™‚ç™ºéŸ³ï¼‰
cargo run -- "c;e;g"  # Cãƒ¡ã‚¸ãƒ£ãƒ¼ã‚³ãƒ¼ãƒ‰

# ã‚«ã‚¹ã‚¿ãƒ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
cargo run -- "cde" -o my_song.mid
```

### å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼š
- `pass1_tokens.json` - ãƒ‘ã‚¹1ã®ãƒˆãƒ¼ã‚¯ãƒ³æƒ…å ±ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
- `pass2_ast.json` - ãƒ‘ã‚¹2ã®ASTæƒ…å ±ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
- `pass3_events.json` - ãƒ‘ã‚¹3ã®MIDIã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
- `output.mid` - æœ€çµ‚çš„ãªMIDIãƒ•ã‚¡ã‚¤ãƒ«

### å¯¾å¿œMMLè¨˜æ³•

ç¾åœ¨å¯¾å¿œã—ã¦ã„ã‚‹è¨˜æ³•ï¼š
- **åŸºæœ¬éŸ³ç¬¦**: `c`, `d`, `e`, `f`, `g`, `a`, `b` (å¤§æ–‡å­—ãƒ»å°æ–‡å­—å¯¾å¿œ)
- **å¤šãƒãƒ£ãƒ³ãƒãƒ«**: `;` ã§ãƒãƒ£ãƒ³ãƒãƒ«åˆ†é›¢ï¼ˆåŒæ™‚ç™ºéŸ³ï¼‰

ä¾‹ï¼š
```
cdefgab     â†’ ãƒ‰ãƒ¬ãƒŸãƒ•ã‚¡ã‚½ãƒ©ã‚·ã®é€£ç¶šå†ç”Ÿ
c;e;g       â†’ Cãƒ»Eãƒ»GéŸ³ã®åŒæ™‚å†ç”Ÿï¼ˆCãƒ¡ã‚¸ãƒ£ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼‰
```

## é–‹ç™º

### ãƒ“ãƒ«ãƒ‰

```bash
cargo build        # ãƒ‡ãƒãƒƒã‚°ãƒ“ãƒ«ãƒ‰
cargo build --release  # ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰
```

### ãƒ†ã‚¹ãƒˆ

```bash
cargo test         # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆ35å€‹ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰
```

### ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆãƒ»Lint

```bash
cargo clippy       # ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
cargo fmt --check  # ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆãƒã‚§ãƒƒã‚¯
cargo fmt          # ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆé©ç”¨
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
src/
â”œâ”€â”€ main.rs              # CLI ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ lib.rs               # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ«ãƒ¼ãƒˆ
â”œâ”€â”€ pass1_parser.rs      # ãƒ‘ã‚¹1: ãƒˆãƒ¼ã‚¯ãƒ³è§£æž
â”œâ”€â”€ pass2_ast.rs         # ãƒ‘ã‚¹2: ASTå¤‰æ›
â”œâ”€â”€ pass3_events.rs      # ãƒ‘ã‚¹3: MIDIã‚¤ãƒ™ãƒ³ãƒˆç”Ÿæˆ
â”œâ”€â”€ pass4_midi.rs        # ãƒ‘ã‚¹4: MIDI ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
â”œâ”€â”€ tree_sitter_mml.rs   # tree-sitter MMLçµ±åˆ
â””â”€â”€ types.rs             # å…±é€šåž‹å®šç¾©

tests/
â”œâ”€â”€ integration_test.rs  # çµ±åˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ test_channel.rs      # ãƒãƒ£ãƒ³ãƒãƒ«æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ test_pass1.rs        # ãƒ‘ã‚¹1ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ test_pass2.rs        # ãƒ‘ã‚¹2ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ test_pass3.rs        # ãƒ‘ã‚¹3ãƒ†ã‚¹ãƒˆ
â””â”€â”€ test_pass4.rs        # ãƒ‘ã‚¹4ãƒ†ã‚¹ãƒˆ
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License - è©³ç´°ã¯ [LICENSE](LICENSE) ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## å‚è€ƒ

- ã‚ªãƒªã‚¸ãƒŠãƒ«ã®Pythonå®Ÿè£…: [cat2151/mmlabc-to-smf](https://github.com/cat2151/mmlabc-to-smf)
