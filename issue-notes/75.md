# issue demoがエラー #75
[issues #75](https://github.com/cat2151/mmlabc-to-smf-rust/issues/75)

## 調査結果 (Investigation Results)

### エラー発生日時
2026年2月4日 - GitHub Actions Workflow Run #8でデプロイメントが失敗

### エラー内容
WASMビルド時にコンパイルエラーが発生：
```
error[E0061]: this function takes 2 arguments but 1 argument was supplied
   --> src/lib.rs:313:18
313 |     let events = pass3_events::ast_to_events(&ast);
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^ argument #2 of type `bool` is missing

note: function defined here
   --> /home/runner/work/mmlabc-to-smf-rust/mmlabc-to-smf-rust/src/pass3_events.rs:49:8
 49 | pub fn ast_to_events(ast: &Ast, use_drum_channel_for_128: bool) -> Vec<MidiEvent> {
    |        ^^^^^^^^^^^^^
```

### 根本原因
1. PR #61でドラムチャンネルサポートが追加され、`pass3_events::ast_to_events()`の関数シグネチャが変更された
2. 新しいパラメータ`use_drum_channel_for_128: bool`が追加されたが、WASMラッパー（`mmlabc-to-smf-wasm/src/lib.rs`）の更新が漏れていた
3. `mmlabc-to-smf-wasm/src/lib.rs:313`で1つの引数のみで関数を呼び出していた

### 修正内容
- PR #63（2026年2月4日）で修正済み
- `mmlabc-to-smf-wasm/src/lib.rs:313`を以下のように修正：
  ```rust
  // 修正前
  let events = pass3_events::ast_to_events(&ast);

  // 修正後
  let events = pass3_events::ast_to_events(&ast, true);
  ```

### 現在の状態
- ✅ 問題は解決済み
- ✅ 最新のデプロイメント（Run #17、2026年2月8日）は成功
- ✅ デモは正常に動作中

## 再発防止策 (Recurrence Prevention Measures)

### 既存の対策
PR #65で実装済み：
- GitHub Actionsのビルド失敗時に自動的にissueを作成する仕組みが導入されている
- `.github/workflows/deploy-github-pages.yml`の67-73行目で実装

### 追加の推奨事項
1. **CI/CDパイプラインの強化**
   - WASMビルドを独立したジョブとして実行し、早期にエラーを検出

2. **型システムの活用**
   - 関数シグネチャ変更時にコンパイラが全ての呼び出し箇所をチェックするため、Rustの型システムが有効に機能した
   - このケースでも最終的にコンパイルエラーで検出されている

3. **コードレビュープロセス**
   - 関数シグネチャを変更するPRでは、全ての呼び出し箇所を確認するチェックリストを使用

4. **統合テスト**
   - WASMバインディングを含む統合テストの追加を検討
   - デモページのE2Eテストを検討

### 教訓
- 関数シグネチャの変更は影響範囲が広いため、全モジュール（特にWASMラッパー）の更新を確認する必要がある
- 既存の自動issue作成機能により、本問題は迅速に検出可能な体制が整っている
